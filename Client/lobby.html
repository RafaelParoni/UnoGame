<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNO   SOCKET.IO</title>
    <link rel="shortcut icon" href="./UnoFavIcon.png" type="image/x-icon">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"> </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.4/socket.io.js"></script>
</head>
<body>
    <h1>Lobby Uno</h1>
</body>
<script>
    var socket = io('http://localhost:3000')

    var user = {
        'name': window.sessionStorage.getItem('name'),
        'icon': window.sessionStorage.getItem('icon'),
        'id': window.sessionStorage.getItem('id'),
    }
    var GameId = window.location.pathname.slice(7, window.location.pathname.length)
    
    socket.emit('userValidation', GameId, user)

    socket.on('userValidationResult', function(result){
        if(result.stats === 'error'){
            if(result.type === 'playerNotFound'){
                alert(result.msg)
            }else if(result.type === 'lobbyNotFound'){
                alert(result.msg)
            }else{
                alert("algo deu errado na verificação do usuario!")
            }
            window.location = '/menu/'
        }else{
            console.log(result.msg)
        }
    })

    var hidden, visibilityChange;
    if(typeof document.hidden !== "undefined") {
        hidden = "hidden";
        visibilityChange = "visibilitychange";
    }else if(typeof document.mozHidden !== "undefined") {
        hidden = "mozHidden";
        visibilityChange = "mozvisibilitychange";
    }else if(typeof document.msHidden !== "undefined") {
        hidden = "msHidden";
        visibilityChange = "msvisibilitychange";
    }else if(typeof document.webkitHidden !== "undefined") {
        hidden = "webkitHidden";
        visibilityChange = "webkitvisibilitychange";
    }
    document.addEventListener(visibilityChange, closePage, false);

    function closePage() {
        socket.emit('CloseAlert', 'close')
    }
    socket.on("CloseAlertValidation", function(data){
        setTimeout(function(){
            socket.emit('CloseAlertValidation', 'ola?')
        },1000)
    })

</script>
</html>